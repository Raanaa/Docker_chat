# Chat system
dockerized __rails application__ with __MYSQL__ database  __Elasticsearch__  and __sidekiq__ 
 ### containers:
   * docker_chat_app_1
  * docker_chat_db_1
  * docker_chat_elastic_1
  * docker_chat_sidekiq_1
*  docker_chat_redis_1

The system allows creating new applications where each application will have :
   * token(generated by the system) 
   * name(provided by the client)


Each application can have many chats. and each chat  have a number. 
Numbering of chats in each application starts from 1 and no 2 chats in the same application  have the same number. 
. A chat contains messages and messages have numbers that start from 1 for each chat. 

   * The token of the application returned in the chat creation request
   * The number of the chat returned in the chat creation request
   * The number of the message returned in the message creation request.
 ##### The client identifies the application by its token and the chat by its number along with the application token.



### installation:
 * install docker on your machine
 * clone this repository   
 *     docker-compose build
 *     docker-compose run --rm app rake db:migrate
 *     docker-compose up 
 
### endpoints:
you can you __postman__ or __curl__ to send requests 

#### 1. create application 
it takes application name as a params
example 

			  curl -X POST \
			  'http://localhost:3000/applications/create?name=my_app_name' \
			 
 you will get a response like that 
 
                  Application created with token = AnY5Zy6oAKN8PLSa4AUYhtDi
  keep this token to be used later 

#### 2. create chat 
it takes application's token (generated at the previous endpoint ) as a params
example 

			  curl -X POST \
              'http://localhost:3000/chats/create?token=AnY5Zy6oAKN8PLSa4AUYhtDi' \
			 
 you will get a response like that 
 
                  Chat created with number =  1
  keep this number to be used later 


#### 3. create message 
it takes application's token, chat's number (generated at the previous endpoint ) and message body as a params

			  curl -X POST \
    'http://localhost:3000/messages/create?body=Hi%20from%20chat%20system&token=AnY5Zy6oAKN8PLSa4AUYhtDi&chat_num=1' \
			 
 you will get a response like that 
 
                  Message created with number =  1
  keep this number to be used later 


#### 4. search messages
it takes application's token, chat's number (generated at the previous endpoint ) and key word to search for in messages (ex: hi )
It's able to partially match messagesâ€™ bodies , using  __ElasticSearch__


			curl -X GET \
    'http://localhost:3000/messages/search?q=hi&chat_num=1&token=AnY5Zy6oAKN8PLSa4AUYhtDi' \
  		 
 you will get a response like that 
 
                  found 2 message/s ________ {1=>"Hi from chat system"}
 message number = 1  
 message body = "Hi from chat system"  


#### 5. get application's chats
it takes application's token and return all chats belong to that application I

			curl -X GET \
    http://localhost:3000/applications/AnY5Zy6oAKN8PLSa4AUYhtDi/chats \
  		 
 you will get a response like that 
 
                  [[1,1]]
 this application has 1 chat  with 1 message
 chat's number = 1 
 chat's messages count = 1

#### 6. get chat's messages
it takes application's token and return all chats belong to that application I

			 curl -X GET \
    'http://localhost:3000/chats/messages?chat_num=1&token=AnY5Zy6oAKN8PLSa4AUYhtDi' \
  		 
 you will get a response like that 
 
                 [4,"Hi from chat system"]
 this chat has 1 message 
message's number = 1 
 message's body = "Hi from chat system"


### 7. get all applications
no params needed

			curl -X GET \
    http://localhost:3000/applications \
  		 
 you will get a response like that 
 
                 [["my_app_name","AnY5Zy6oAKN8PLSa4AUYhtDi",1]]
here we have only one application 
it's name = "my_app_name" 
it's token = "AnY5Zy6oAKN8PLSa4AUYhtDi" 
it's chats count = 1 

### 8. get all messages
no params needed

			curl -X GET \
    http://localhost:3000/messages \
  		 
 you will get a response like that 
 
                 ["Hi from chat system"]
here we have only one message 
it's body = "Hi from chat system" 



### 9. update application
it takes application token and the new updated name as params

			curl -X PUT \
    'http://localhost:3000/applications/update?application_token=AnY5Zy6oAKN8PLSa4AUYhtDi&name=new_name' \
    
  		 
 you will get a response like that 
 
                application name updated to be [ new_name ]



### 10. update message
it takes application token , chat number and the new updated message body  as params

			curl -X PUT \
    'http://localhost:3000/messages/update?msg_num=1&chat_num=1&token=AnY5Zy6oAKN8PLSa4AUYhtDi&body=hi%20,%20updated%20message' \
    
  		 
 you will get a response like that 
 
                message body updated to be [ hi , updated message ]

